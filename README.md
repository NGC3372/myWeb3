# myWeb3

本项目是基于python3的本地同以太坊交互代码，其功能是在web3.py库的基础上重新封装代码，力图简化web3同以太坊交互的代码复杂度，现共享出来共同学习。如要深入了解web3的交互逻辑，请学习并使用原生的web3库。


## 运行环境需求：web3.py
    安装： pip3 install web3

## 使用
* 初始化对象（默认连接ropsten公共测试链）
```python
from myWeb3 import myWeb3
w3 = myWeb3() 
```
- 初始化账号
```python
w3.initAccount()
```
- 获取账户余额
```python
address = '0x61bEa2058e8d5a01F1f9898E49F53Cc3cc8E6520'
w3.getBalance(address)
```
- 发起交易
```python
hashtx = w3.makeTransaction('0x61bEa2058e8d5a01F1f9898E49F53Cc3cc8E6520',100000000000000000)
print(hashtx)
```
- 部署合约
```python
bytecode = '60806040526040518060400160405280600781526020017f64656661756c74000000000000000000000000000000000000000000000000008152506000908051906020019061004f929190610062565b5034801561005c57600080fd5b50610107565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a357805160ff19168380011785556100d1565b828001600101855582156100d1579182015b828111156100d05782518255916020019190600101906100b5565b5b5090506100de91906100e2565b5090565b61010491905b808211156101005760008160009055506001016100e8565b5090565b90565b6103c5806101166000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c8063954ab4b21461003b578063ee848887146100be575b600080fd5b6100436101f2565b6040518080602001828103825283818151815260200191508051906020019080838360005b83811015610083578082015181840152602081019050610068565b50505050905090810190601f1680156100b05780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b610177600480360360208110156100d457600080fd5b81019080803590602001906401000000008111156100f157600080fd5b82018360208201111561010357600080fd5b8035906020019184600183028401116401000000008311171561012557600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f820116905080830192505050505050509192919290505050610294565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156101b757808201518184015260208101905061019c565b50505050905090810190601f1680156101e45780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b606060008054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561028a5780601f1061025f5761010080835404028352916020019161028a565b820191906000526020600020905b81548152906001019060200180831161026d57829003601f168201915b5050505050905090565b606081600090805190602001906102ac9291906102ea565b506040518060400160405280600281526020017f6f6b0000000000000000000000000000000000000000000000000000000000008152509050919050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061032b57805160ff1916838001178555610359565b82800160010185558215610359579182015b8281111561035857825182559160200191906001019061033d565b5b509050610366919061036a565b5090565b61038c91905b80821115610388576000816000905550600101610370565b5090565b9056fea2646970667358221220eeed3e677a1a785e131aef237f6ad185c8e84a64371e06c18c73428883ce44c064736f6c63430006000033'
result = web3.deployContract(byteCode)
print(result)
```
- 调用合约
  * 使用gas
  ```python
  contractAddress = '0x19E09911807b37a2Bd0CE5F09feF579747197EE2'
  ABI = '[{"inputs": [{"internalType": "string", "name": "temp", "type": "string"}], "name": "changeSay", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [], "name": "say", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "view", "type": "function"}]'
  function = w3.getContractFunction(contractAddress,ABI , 'changeSay')
  result = w3.runContractFunction(True , function('hello world'))
  print(result)
  ```
  * 不使用gas
  ```python
  contractAddress = '0x19E09911807b37a2Bd0CE5F09feF579747197EE2'
  ABI = '[{"inputs": [{"internalType": "string", "name": "temp", "type": "string"}], "name": "changeSay", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [], "name": "say", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "view", "type": "function"}]'
  function = w3.getContractFunction(contractAddress,ABI , 'say')
  result = w3.runContractFunction(False , function())
  print(result)
  ```

  
* 获取交易收据的详细信息
```python
hashTx = '0xd89e41b784839210e83274576750affec8ee2f00a722b59882a7af8fd375db17'
w3.getReceiptInfoFromHash(hashTx)
```
* 获取交易详细信息     
```python
hashTx = '0xd89e41b784839210e83274576750affec8ee2f00a722b59882a7af8fd375db17'
w3.getTransactionInfoFromHash(hashTx)
```
## 注
由于智能合约所用的solidity语言版本混乱，不同版本代码语法变化过多，本项目并没有实现本地编译solidity代码的功能（目前我只能通过代码编译6.0之后的solitidy代码，如后期寻找到解决方法我会补充）。部署和调用智能合约功能部分的函数所需参数：bytecode和ABI 均可通过在线solidity编译器[remix](http://remix.ethereum.org)内导出。当然，目前有更成熟的第三方工具提供合约的编写和部署等功能。如[Truffle](https://www.trufflesuite.com),感兴趣的可自行了解。
  
  
